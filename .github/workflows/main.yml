      - name: Create JavaScript wrapper
        run: |
          cd qemu/output/${{matrix.target}}
          
          cat > qemu-wrapper.js << EOF
          /**
           * QEMU WebAssembly Wrapper
           * Provides a simplified interface for running QEMU in the browser
           */
          class QEMUJS {
            constructor() {
              this.module = null;
              this.isRunning = false;
            }
            async initialize() {
              if (this.module) {
                return this.module;
              }
              try {
                this.module = await import('./qemu-system-${{matrix.arch}}.js');
                return this.module;
              } catch (error) {
                console.error('Failed to load QEMU module:', error);
                throw error;
              }
            }
            async start(config = {}) {
              if (!this.module) {
                await this.initialize();
              }
              if (this.isRunning) {
                console.warn('QEMU is already running');
                return;
              }
              const defaultConfig = {
                memory: '256M',
                cpu: '${{matrix.arch}}',
                kvm: false,
                display: 'none',
                netdev: 'user',
                drives: []
              };
              const qemuConfig = { ...defaultConfig, ...config };
             
              try {
                const args = this.buildArgs(qemuConfig);
                this.isRunning = true;
                await this.module.callMain(args);
                console.log('QEMU started successfully');
              } catch (error) {
                console.error('Failed to start QEMU:', error);
                this.isRunning = false;
                throw error;
              }
            }
            buildArgs(config) {
              const args = [];
              args.push('-m', config.memory);
              args.push('-cpu', config.cpu);
              args.push('-no-kvm');
              args.push('-display', config.display);
              if (config.netdev) {
                args.push('-netdev', config.netdev);
                args.push('-device', 'e1000,netdev=net0');
              }
              config.drives.forEach((drive, index) => {
                args.push('-drive', \`file=\${drive.file},format=\${drive.format || 'raw'},if=\${drive.interface || 'ide'},index=\${index}\`);
              });
              return args;
            }
            stop() {
              if (this.isRunning) {
                console.log('Stopping QEMU...');
                this.isRunning = false;
              }
            }
            getStatus() {
              return {
                isRunning: this.isRunning,
                module: this.module ? 'loaded' : 'not loaded'
              };
            }
          }
          if (typeof module !== 'undefined' && module.exports) {
            module.exports = QEMUJS;
          } else if (typeof window !== 'undefined') {
            window.QEMUJS = QEMUJS;
          } else {
            global.QEMUJS = QEMUJS;
          }
          EOF
